import{r as m,j as e,C as $,c as H,e as J,a as W,u as X,f as Y,g as k,i as Z,t as M}from"./main-deOYDPWY.js";import{u as L,a as ee,b as te,C as se,T as ae,c as re}from"./useDebounce-BsBQ78x4.js";import{L as ne,u as le,C as A}from"./CustomTextInput-CVvPr6Oa.js";import{c as v}from"./index-B3fMHV4j.js";import{B as P}from"./button-CaKppYKQ.js";import{B as de}from"./badge-DcPkLrDx.js";import{F as D}from"./file-text-DlucEsTC.js";import{E as oe}from"./eye-DEYj2jSP.js";function ce({field:a,label:N,placeholder:j="Select an option",helperText:y,options:r,disabled:C=!1,className:f}){const[c,l]=m.useState(!1),x=m.useRef(null),n=a.state.value,u=a.state.meta.isTouched&&Array.isArray(a.state.meta.errors)&&a.state.meta.errors&&a.state.meta.errors.length>0,d=u&&Array.isArray(a.state.meta.errors)?a.state.meta.errors[0]:void 0,S=r.find(s=>s.value===n),b=s=>{s.disabled||(a.handleChange(s.value),l(!1),a.handleBlur())},O=s=>{if(s.key==="Enter"||s.key===" ")s.preventDefault(),l(!c);else if(s.key==="Escape")l(!1);else if(s.key==="ArrowDown")if(s.preventDefault(),!c)l(!0);else{const g=(r.findIndex(p=>p.value===n)+1)%r.length,i=r[g];i&&!i.disabled&&a.handleChange(i.value)}else if(s.key==="ArrowUp"&&(s.preventDefault(),c)){const h=r.findIndex(p=>p.value===n),g=h<=0?r.length-1:h-1,i=r[g];i&&!i.disabled&&a.handleChange(i.value)}};return m.useEffect(()=>{const s=h=>{x.current&&!x.current.contains(h.target)&&l(!1)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]),e.jsxs("div",{className:"space-y-2",children:[N&&e.jsx(ne,{htmlFor:`select-${a.name}`,className:v(u&&"text-red-500"),children:N}),e.jsxs("div",{className:"relative",ref:x,children:[e.jsxs("div",{id:`select-${a.name}`,role:"combobox","aria-expanded":c,"aria-haspopup":"listbox",tabIndex:C?-1:0,className:v("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background cursor-pointer","focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2","disabled:cursor-not-allowed disabled:opacity-50",u&&"border-red-500 focus:ring-red-500",f),onClick:()=>!C&&l(!c),onKeyDown:O,children:[e.jsx("span",{className:v("flex-1 text-left",!S&&"text-muted-foreground"),children:S?.label||j}),e.jsx($,{className:v("h-4 w-4 opacity-50 transition-transform",c&&"rotate-180")})]}),c&&e.jsx("div",{className:"absolute top-full z-50 w-full mt-1 rounded-md border bg-popover shadow-md",children:e.jsx("div",{role:"listbox",className:"max-h-60 overflow-auto p-1",children:r.map(s=>e.jsx("div",{role:"option","aria-selected":s.value===n,className:v("relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none","hover:bg-accent hover:text-accent-foreground","focus:bg-accent focus:text-accent-foreground",s.value===n&&"bg-accent text-accent-foreground",s.disabled&&"pointer-events-none opacity-50"),onClick:()=>b(s),children:s.label},s.value))})})]}),e.jsx("div",{className:"flex justify-between items-start",children:e.jsx("div",{className:"flex-1",children:(d||y)&&e.jsx("p",{className:v("text-sm",u?"text-red-500":"text-muted-foreground"),children:d||y})})})]})}const ie=W("86f303f442bd6a6cd2200a3b53b5498707cf3134f40c6dc657d3f51d7acd4433"),ue=H({method:"POST"}).middleware([J]).handler(ie),me=[{value:"",label:"All Statuses"},{value:"PENDING",label:"Pending"},{value:"PROCESSING",label:"Processing"},{value:"COMPLETED",label:"Completed"},{value:"CANCELLED",label:"Cancelled"}];function je(){const a=X(),N=Y(),[j,y]=m.useState(""),[r,C]=m.useState(""),[f,c]=m.useState(""),l=L(j,500),x=L(r,500),[n,u]=m.useState({total:0,limit:25,offset:0,hasMore:!1}),{dialogState:d,openDialog:S,closeDialog:b,handleConfirm:O}=ee(),s=k(Z),h=k(ue),{data:g,isLoading:i,error:p,refetch:B}=te({queryKey:["orders",n.limit,n.offset,l,x,f],queryFn:()=>s({data:{limit:n.limit,offset:n.offset,orderNumber:l||void 0,patientName:x||void 0,status:f||void 0}}),staleTime:3e4});m.useEffect(()=>{u(t=>({...t,offset:0}))},[l,x,f]);const E=le({mutationFn:t=>h({data:{id:t}}),onSuccess:()=>{N.invalidateQueries({queryKey:["orders"]}),M.success("Order deleted successfully"),b()},onError:t=>{M.error("Error deleting order: "+t.message),b()}}),F=t=>{y(t)},R=t=>{C(t)},q=t=>{c(t)},z=t=>{u(o=>({...o,offset:t}))},V=t=>{u(o=>({...o,limit:t,offset:0}))},G=t=>{S({title:"Delete Order",description:"Are you sure you want to delete this order? This action cannot be undone.",id:t,confirmText:"Delete",cancelText:"Cancel",variant:"destructive",onConfirm:o=>{E.mutate(o)}})},K=t=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t),_=t=>{switch(t){case"COMPLETED":return"default";case"PENDING":return"outline";case"CANCELLED":return"destructive";default:return"outline"}},w=g?.orders||[],I=g?.pagination||n,Q=[{key:"orderNumber",header:"Order #",accessor:"orderNumber",className:"font-medium"},{key:"patient",header:"Patient",render:t=>e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t.patient.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t.patient.email||t.patient.phone||"No contact info"})]})},{key:"items",header:"Tests",render:t=>e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm",children:[t._count.orderItems," test",t._count.orderItems!==1?"s":""]}),t.orderItems.slice(0,2).map(o=>e.jsx("p",{className:"text-xs text-muted-foreground",children:o.labTest.name},o.id)),t.orderItems.length>2&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["+",t.orderItems.length-2," more..."]})]})},{key:"totalAmount",header:"Total",render:t=>{const o=t.totalAmount||t.orderItems?.reduce((U,T)=>U+(T.unitPrice||T.labTest?.price||0)*T.quantity,0)||0;return e.jsx("span",{className:"font-medium",children:K(o)})},className:"text-right"},{key:"status",header:"Status",render:t=>e.jsx(de,{variant:_(t.status),children:t.status}),className:"text-center"},{key:"estimatedReady",header:"Est. Ready",render:t=>t.estimatedReady?new Date(t.estimatedReady).toLocaleDateString():"TBD",className:"text-muted-foreground text-sm"},{key:"createdAt",header:"Created",render:t=>new Date(t.createdAt).toLocaleDateString(),className:"text-muted-foreground text-sm"}];return p?e.jsx("div",{className:"container mx-auto py-4",children:e.jsxs("div",{className:"text-center text-red-500",children:["Error loading orders: ",p.message,e.jsx("br",{}),e.jsx(P,{onClick:()=>B(),className:"mt-4",children:"Try Again"})]})}):e.jsxs("div",{className:"container mx-auto py-4 space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Orders"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage lab test orders and their statuses"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(A,{field:{name:"orderSearch",state:{value:j,meta:{errors:[],isTouched:!1,isBlurred:!1,isDirty:!1,errorMap:{},errorSourceMap:{},isValidating:!1}},handleChange:F,handleBlur:()=>{}},placeholder:"Search by order number...",label:"Order Number"}),e.jsx(A,{field:{name:"patientSearch",state:{value:r,meta:{errors:[],isTouched:!1,isBlurred:!1,isDirty:!1,errorMap:{},errorSourceMap:{},isValidating:!1}},handleChange:R,handleBlur:()=>{}},placeholder:"Search by patient name...",label:"Patient Name"}),e.jsx(ce,{field:{name:"statusFilter",state:{value:f,meta:{errors:[],isTouched:!1,isBlurred:!1,isDirty:!1,errorMap:{},errorSourceMap:{},isValidating:!1}},handleChange:q,handleBlur:()=>{}},options:me,label:"Status Filter",placeholder:"Select status..."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-card rounded-lg border p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Orders"}),e.jsx("p",{className:"text-2xl font-bold",children:I.total})]}),e.jsx(D,{className:"h-8 w-8 text-blue-500"})]})}),e.jsx("div",{className:"bg-card rounded-lg border p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Pending Orders"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:w.filter(t=>t.status==="PENDING").length})]}),e.jsx(D,{className:"h-8 w-8 text-yellow-500"})]})}),e.jsx("div",{className:"bg-card rounded-lg border p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Completed"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:w.filter(t=>t.status==="COMPLETED").length})]}),e.jsx(D,{className:"h-8 w-8 text-blue-500"})]})}),e.jsx("div",{className:"bg-card rounded-lg border p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Completed"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:w.filter(t=>t.status==="COMPLETED").length})]}),e.jsx(D,{className:"h-8 w-8 text-green-500"})]})})]}),e.jsx(se,{data:w,columns:Q,pagination:I,onPageChange:z,onPageSizeChange:V,loading:i,emptyMessage:"No orders found",actions:t=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{variant:"outline",size:"sm",onClick:()=>a({to:"/orders/$orderId",params:{orderId:t.id}}),children:e.jsx(oe,{className:"h-4 w-4"})}),e.jsx(P,{variant:"outline",size:"sm",onClick:()=>G(t.id),className:"text-destructive hover:text-destructive",disabled:E.isPending,children:e.jsx(ae,{className:"h-4 w-4"})})]})}),e.jsx(re,{isOpen:d.isOpen,onClose:b,onConfirm:O,title:d.title,description:d.description,confirmText:d.confirmText,cancelText:d.cancelText,id:d.id,variant:d.variant,isLoading:E.isPending})]})}export{je as component};
