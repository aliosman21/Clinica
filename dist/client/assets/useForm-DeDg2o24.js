import{K as Lt,r as R,j as Y}from"./main-deOYDPWY.js";const $=new WeakMap,X=new WeakMap,Z={current:[]};let at=!1,N=0;const U=new Set,K=new Map;function bt(i){const r=Array.from(i).sort((e,t)=>e instanceof L&&e.options.deps.includes(t)?1:t instanceof L&&t.options.deps.includes(e)?-1:0);for(const e of r){if(Z.current.includes(e))continue;Z.current.push(e),e.recompute();const t=X.get(e);if(t)for(const s of t){const n=$.get(s);n&&bt(n)}}}function Tt(i){const r={prevVal:i.prevState,currentVal:i.state};for(const e of i.listeners)e(r)}function It(i){const r={prevVal:i.prevState,currentVal:i.state};for(const e of i.listeners)e(r)}function St(i){if(N>0&&!K.has(i)&&K.set(i,i.prevState),U.add(i),!(N>0)&&!at)try{for(at=!0;U.size>0;){const r=Array.from(U);U.clear();for(const e of r){const t=K.get(e)??e.prevState;e.prevState=t,Tt(e)}for(const e of r){const t=$.get(e);t&&(Z.current.push(e),bt(t))}for(const e of r){const t=$.get(e);if(t)for(const s of t)It(s)}}}finally{at=!1,Z.current=[],K.clear()}}function A(i){N++;try{i()}finally{if(N--,N===0){const r=U.values().next().value;r&&St(r)}}}function Dt(i){return typeof i=="function"}class tt{constructor(r,e){this.listeners=new Set,this.subscribe=t=>{var s,n;this.listeners.add(t);const a=(n=(s=this.options)==null?void 0:s.onSubscribe)==null?void 0:n.call(s,t,this);return()=>{this.listeners.delete(t),a?.()}},this.prevState=r,this.state=r,this.options=e}setState(r){var e,t,s;this.prevState=this.state,(e=this.options)!=null&&e.updateFn?this.state=this.options.updateFn(this.prevState)(r):Dt(r)?this.state=r(this.prevState):this.state=r,(s=(t=this.options)==null?void 0:t.onUpdate)==null||s.call(t),St(this)}}class L{constructor(r){this.listeners=new Set,this._subscriptions=[],this.lastSeenDepValues=[],this.getDepVals=()=>{const e=this.options.deps.length,t=new Array(e),s=new Array(e);for(let n=0;n<e;n++){const a=this.options.deps[n];t[n]=a.prevState,s[n]=a.state}return this.lastSeenDepValues=s,{prevDepVals:t,currDepVals:s,prevVal:this.prevState??void 0}},this.recompute=()=>{var e,t;this.prevState=this.state;const s=this.getDepVals();this.state=this.options.fn(s),(t=(e=this.options).onUpdate)==null||t.call(e)},this.checkIfRecalculationNeededDeeply=()=>{for(const n of this.options.deps)n instanceof L&&n.checkIfRecalculationNeededDeeply();let e=!1;const t=this.lastSeenDepValues,{currDepVals:s}=this.getDepVals();for(let n=0;n<s.length;n++)if(s[n]!==t[n]){e=!0;break}e&&this.recompute()},this.mount=()=>(this.registerOnGraph(),this.checkIfRecalculationNeededDeeply(),()=>{this.unregisterFromGraph();for(const e of this._subscriptions)e()}),this.subscribe=e=>{var t,s;this.listeners.add(e);const n=(s=(t=this.options).onSubscribe)==null?void 0:s.call(t,e,this);return()=>{this.listeners.delete(e),n?.()}},this.options=r,this.state=r.fn({prevDepVals:void 0,prevVal:void 0,currDepVals:this.getDepVals().currDepVals})}registerOnGraph(r=this.options.deps){for(const e of r)if(e instanceof L)e.registerOnGraph(),this.registerOnGraph(e.options.deps);else if(e instanceof tt){let t=$.get(e);t||(t=new Set,$.set(e,t)),t.add(this);let s=X.get(this);s||(s=new Set,X.set(this,s)),s.add(e)}}unregisterFromGraph(r=this.options.deps){for(const e of r)if(e instanceof L)this.unregisterFromGraph(e.options.deps);else if(e instanceof tt){const t=$.get(e);t&&t.delete(this);const s=X.get(this);s&&s.delete(e)}}}function _t(i){return typeof i=="function"}function ft(i,...r){return _t(i)?i(...r):i}function kt(i){return i||(typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():"")}class Vt{#s=!0;#t;#e;#n;#i;#r;#a;#l;#c=0;#h=5;#o=!1;#d=()=>{this.debugLog("Connected to event bus"),this.#r=!0,this.#o=!1,this.debugLog("Emitting queued events",this.#i),this.#i.forEach(r=>this.emitEventToBus(r)),this.#i=[],this.stopConnectLoop(),this.#e().removeEventListener("tanstack-connect-success",this.#d)};#u=()=>{if(this.#c<this.#h){this.#c++,this.dispatchCustomEvent("tanstack-connect",{});return}this.#e().removeEventListener("tanstack-connect",this.#u),this.debugLog("Max retries reached, giving up on connection"),this.stopConnectLoop()};#f=()=>{this.#o||(this.#o=!0,this.#e().addEventListener("tanstack-connect-success",this.#d),this.#u())};constructor({pluginId:r,debug:e=!1,enabled:t=!0,reconnectEveryMs:s=300}){this.#t=r,this.#s=t,this.#e=this.getGlobalTarget,this.#n=e,this.debugLog(" Initializing event subscription for plugin",this.#t),this.#i=[],this.#r=!1,this.#a=null,this.#l=s}startConnectLoop(){this.#a!==null||this.#r||(this.debugLog(`Starting connect loop (every ${this.#l}ms)`),this.#a=setInterval(this.#u,this.#l))}stopConnectLoop(){this.#o=!1,this.#a!==null&&(clearInterval(this.#a),this.#a=null,this.debugLog("Stopped connect loop"))}debugLog(...r){this.#n&&console.log(`ðŸŒ´ [tanstack-devtools:${this.#t}-plugin]`,...r)}getGlobalTarget(){if(typeof globalThis<"u"&&globalThis.__TANSTACK_EVENT_TARGET__)return this.debugLog("Using global event target"),globalThis.__TANSTACK_EVENT_TARGET__;if(typeof window<"u"&&typeof window.addEventListener<"u")return this.debugLog("Using window as event target"),window;const r=typeof EventTarget<"u"?new EventTarget:void 0;return typeof r>"u"||typeof r.addEventListener>"u"?(this.debugLog("No event mechanism available, running in non-web environment"),{addEventListener:()=>{},removeEventListener:()=>{},dispatchEvent:()=>!1}):(this.debugLog("Using new EventTarget as fallback"),r)}getPluginId(){return this.#t}dispatchCustomEventShim(r,e){try{const t=new Event(r,{detail:e});this.#e().dispatchEvent(t)}catch{this.debugLog("Failed to dispatch shim event")}}dispatchCustomEvent(r,e){try{this.#e().dispatchEvent(new CustomEvent(r,{detail:e}))}catch{this.dispatchCustomEventShim(r,e)}}emitEventToBus(r){this.debugLog("Emitting event to client bus",r),this.dispatchCustomEvent("tanstack-dispatch-event",r)}emit(r,e){if(!this.#s){this.debugLog("Event bus client is disabled, not emitting event",r,e);return}if(!this.#r){this.debugLog("Bus not available, will be pushed as soon as connected"),this.#i.push({type:`${this.#t}:${r}`,payload:e,pluginId:this.#t}),typeof CustomEvent<"u"&&!this.#o&&(this.#f(),this.startConnectLoop());return}return this.emitEventToBus({type:`${this.#t}:${r}`,payload:e,pluginId:this.#t})}on(r,e){const t=`${this.#t}:${r}`;if(!this.#s)return this.debugLog("Event bus client is disabled, not registering event",t),()=>{};const s=n=>{this.debugLog("Received event from bus",n.detail),e(n.detail)};return this.#e().addEventListener(t,s),this.debugLog("Registered event to bus",t),()=>{this.#e().removeEventListener(t,s)}}onAll(r){if(!this.#s)return this.debugLog("Event bus client is disabled, not registering event"),()=>{};const e=t=>{const s=t.detail;r(s)};return this.#e().addEventListener("tanstack-devtools-global",e),()=>this.#e().removeEventListener("tanstack-devtools-global",e)}onAllPluginEvents(r){if(!this.#s)return this.debugLog("Event bus client is disabled, not registering event"),()=>{};const e=t=>{const s=t.detail;this.#t&&s.pluginId!==this.#t||r(s)};return this.#e().addEventListener("tanstack-devtools-global",e),()=>this.#e().removeEventListener("tanstack-devtools-global",e)}}class Ot extends Vt{constructor(r){super({pluginId:"pacer",debug:r?.debug})}}const Ct=(i,r)=>{Ft.emit(i,r)},Ft=new Ot;function mt(){return{executionCount:0,isPending:!1,lastArgs:void 0,lastExecutionTime:0,nextExecutionTime:0,status:"idle",maybeExecuteCount:0}}const Pt={enabled:!0,leading:!0,trailing:!0,wait:0};class $t{constructor(r,e){this.fn=r,this.store=new tt(mt()),this.setOptions=t=>{this.options={...this.options,...t},this.#e()||this.cancel()},this.#t=t=>{this.store.setState(s=>{const n={...s,...t},{isPending:a}=n;return{...n,status:this.#e()?a?"pending":"idle":"disabled"}}),Ct("Throttler",this)},this.#e=()=>!!ft(this.options.enabled,this),this.#n=()=>ft(this.options.wait,this),this.maybeExecute=(...t)=>{this.#t({maybeExecuteCount:this.store.state.maybeExecuteCount+1});const s=Date.now(),n=s-this.store.state.lastExecutionTime,a=this.#n();if(this.options.leading&&n>=a)this.#i(...t);else if(this.#t({lastArgs:t}),!this.#s&&this.options.trailing){const c=this.store.state.lastExecutionTime?s-this.store.state.lastExecutionTime:0,u=a-c;this.#t({isPending:!0}),this.#s=setTimeout(()=>{const{lastArgs:l}=this.store.state;l!==void 0&&this.#i(...l)},u)}},this.#i=(...t)=>{if(!this.#e())return;this.fn(...t);const s=Date.now(),n=s+this.#n();this.#r(),this.#t({executionCount:this.store.state.executionCount+1,lastExecutionTime:s,nextExecutionTime:n,isPending:!1,lastArgs:void 0}),this.options.onExecute?.(t,this),setTimeout(()=>{this.store.state.isPending||this.#t({nextExecutionTime:void 0})},this.#n())},this.flush=()=>{this.store.state.isPending&&this.store.state.lastArgs&&this.#i(...this.store.state.lastArgs)},this.#r=()=>{this.#s&&(clearTimeout(this.#s),this.#s=void 0)},this.cancel=()=>{this.#r(),this.#t({lastArgs:void 0,isPending:!1})},this.reset=()=>{this.#t(mt())},this.key=kt(e.key),this.options={...Pt,...e},this.#t(this.options.initialState??{}),Ft.on("d-Throttler",t=>{t.payload.key===this.key&&(this.#t(t.payload.store.state),this.setOptions(t.payload.options))})}#s;#t;#e;#n;#i;#r}function Bt(i,r){return new $t(i,r).maybeExecute}function it(i,r){return typeof i=="function"?i(r):i}function W(i,r){return ht(r).reduce((t,s)=>{if(t===null)return null;if(typeof t<"u")return t[s]},i)}function z(i,r,e){const t=ht(r);function s(n){if(!t.length)return it(e,n);const a=t.shift();if(typeof a=="string"||typeof a=="number"&&!Array.isArray(n))return typeof n=="object"?(n===null&&(n={}),{...n,[a]:s(n[a])}):{[a]:s()};if(Array.isArray(n)&&typeof a=="number"){const c=n.slice(0,a);return[...c.length?c:new Array(a),s(n[a]),...n.slice(a+1)]}return[...new Array(a),s()]}return s(i)}function Rt(i,r){const e=ht(r);function t(s){if(!s)return;if(e.length===1){const a=e[0];if(Array.isArray(s)&&typeof a=="number")return s.filter((l,f)=>f!==a);const{[a]:c,...u}=s;return u}const n=e.shift();if(typeof n=="string"&&typeof s=="object")return{...s,[n]:t(s[n])};if(typeof n=="number"&&Array.isArray(s)){if(n>=s.length)return s;const a=s.slice(0,n);return[...a.length?a:new Array(n),t(s[n]),...s.slice(n+1)]}throw new Error("It seems we have created an infinite loop in deleteBy. ")}return t(i)}const xt=/^(\d+)$/gm,Ut=/\.(\d+)(?=\.)/gm,Wt=/^(\d+)\./gm,Nt=/\.(\d+$)/gm,Kt=/\.{2,}/gm,lt="__int__",G=`${lt}$1`;function ht(i){if(Array.isArray(i))return[...i];if(typeof i!="string")throw new Error("Path must be a string.");return i.replace(/(^\[)|]/gm,"").replace(/\[/g,".").replace(xt,G).replace(Ut,`.${G}.`).replace(Wt,`${G}.`).replace(Nt,`.${G}`).replace(Kt,".").split(".").map(r=>{if(r.startsWith(lt)){const e=r.substring(lt.length),t=parseInt(e,10);return String(t)===e?t:e}return r})}function zt(i){return!(Array.isArray(i)&&i.length===0)}function ut(i,r){const e=t=>t.validators.filter(Boolean).map(s=>({cause:s.cause,validate:s.fn}));return r.validationLogic({form:r.form,validators:r.validators,event:{type:i,async:!1},runValidation:e})}function ct(i,r){const{asyncDebounceMs:e}=r,{onBlurAsyncDebounceMs:t,onChangeAsyncDebounceMs:s,onDynamicAsyncDebounceMs:n}=r.validators||{},a=e??0,c=u=>u.validators.filter(Boolean).map(l=>{const f=l?.cause||i;let d=a;switch(f){case"change":d=s??a;break;case"blur":d=t??a;break;case"dynamic":d=n??a;break;case"submit":d=0;break}return i==="submit"&&(d=0),{cause:f,validate:l.fn,debounceMs:d}});return r.validationLogic({form:r.form,validators:r.validators,event:{type:i,async:!0},runValidation:c})}const dt=i=>!!i&&typeof i=="object"&&"fields"in i;function C(i,r){if(Object.is(i,r))return!0;if(typeof i!="object"||i===null||typeof r!="object"||r===null)return!1;if(i instanceof Date&&r instanceof Date)return i.getTime()===r.getTime();if(i instanceof Map&&r instanceof Map){if(i.size!==r.size)return!1;for(const[s,n]of i)if(!r.has(s)||!Object.is(n,r.get(s)))return!1;return!0}if(i instanceof Set&&r instanceof Set){if(i.size!==r.size)return!1;for(const s of i)if(!r.has(s))return!1;return!0}const e=Object.keys(i),t=Object.keys(r);if(e.length!==t.length)return!1;for(const s of e)if(!t.includes(s)||!C(i[s],r[s]))return!1;return!0}const vt=({newFormValidatorError:i,isPreviousErrorFromFormValidator:r,previousErrorValue:e})=>i?{newErrorValue:i,newSource:"form"}:r?{newErrorValue:void 0,newSource:void 0}:e?{newErrorValue:e,newSource:"field"}:{newErrorValue:void 0,newSource:void 0},gt=({formLevelError:i,fieldLevelError:r})=>r?{newErrorValue:r,newSource:"field"}:i?{newErrorValue:i,newSource:"form"}:{newErrorValue:void 0,newSource:void 0};function F(i,r){return i==null?r:{...i,...r}}let k=256;const J=[];let q;for(;k--;)J[k]=(k+256).toString(16).substring(1);function Gt(){let i=0,r,e="";if(!q||k+16>256){for(q=new Array(256),i=256;i--;)q[i]=256*Math.random()|0;i=0,k=0}for(;i<16;i++)r=q[k+i],i===6?e+=J[r&15|64]:i===8?e+=J[r&63|128]:e+=J[r],i&1&&i>1&&i<11&&(e+="-");return k++,e}const P=i=>{if(!i.validators)return i.runValidation({validators:[],form:i.form});const r=i.event.async,e=r?void 0:{fn:i.validators.onMount,cause:"mount"},t={fn:r?i.validators.onChangeAsync:i.validators.onChange,cause:"change"},s={fn:r?i.validators.onBlurAsync:i.validators.onBlur,cause:"blur"},n={fn:r?i.validators.onSubmitAsync:i.validators.onSubmit,cause:"submit"},a=r?void 0:{fn:()=>{},cause:"server"};switch(i.event.type){case"mount":return i.runValidation({validators:[e],form:i.form});case"submit":return i.runValidation({validators:[t,s,n,a],form:i.form});case"server":return i.runValidation({validators:[],form:i.form});case"blur":return i.runValidation({validators:[s,a],form:i.form});case"change":return i.runValidation({validators:[t,a],form:i.form});default:throw new Error(`Unknown validation event type: ${i.event.type}`)}};function qt(i,r){const e=new Map;for(const t of i){const s=t.path??[];let n=r,a="";for(let c=0;c<s.length;c++){const u=s[c];if(u===void 0)continue;const l=typeof u=="object"?u.key:u,f=Number(l);Array.isArray(n)&&!Number.isNaN(f)?a+=`[${f}]`:a+=(c>0?".":"")+String(l),typeof n=="object"&&n!==null?n=n[l]:n=void 0}e.set(a,(e.get(a)??[]).concat(t))}return Object.fromEntries(e)}const pt=(i,r)=>{const e=qt(i,r);return{form:e,fields:e}},B={validate({value:i,validationSource:r},e){const t=e["~standard"].validate(i);if(t instanceof Promise)throw new Error("async function passed to sync validator");if(t.issues)return r==="field"?t.issues:pt(t.issues,i)},async validateAsync({value:i,validationSource:r},e){const t=await e["~standard"].validate(i);if(t.issues)return r==="field"?t.issues:pt(t.issues,i)}},Et=i=>!!i&&"~standard"in i,et={isValidating:!1,isTouched:!1,isBlurred:!1,isDirty:!1,isPristine:!0,isValid:!0,isDefaultValue:!0,errors:[],errorMap:{},errorSourceMap:{}};function H(i){function r(d,o,m,h){const v=t(d,o,m,h);({insert:()=>c(v,d,o),remove:()=>u(v),swap:()=>h!==void 0&&f(v,d,o,h),move:()=>h!==void 0&&l(v,d,o,h)})[m]()}function e(d,o){return`${d}[${o}]`}function t(d,o,m,h){const v=[e(d,o)];if(m==="swap")v.push(e(d,h));else if(m==="move"){const[g,M]=[Math.min(o,h),Math.max(o,h)];for(let p=g;p<=M;p++)v.push(e(d,p))}else{const g=i.getFieldValue(d),M=Array.isArray(g)?g.length:0;for(let p=o+1;p<M;p++)v.push(e(d,p))}return Object.keys(i.fieldInfo).filter(g=>v.some(M=>g.startsWith(M)))}function s(d,o){return d.replace(/\[(\d+)\]/,(m,h)=>{const v=parseInt(h,10);return`[${o==="up"?v+1:Math.max(0,v-1)}]`})}function n(d,o){(o==="up"?d:[...d].reverse()).forEach(h=>{const v=s(h.toString(),o),g=i.getFieldMeta(v);g?i.setFieldMeta(h,g):i.setFieldMeta(h,a())})}const a=()=>et,c=(d,o,m)=>{n(d,"down"),d.forEach(h=>{h.toString().startsWith(e(o,m))&&i.setFieldMeta(h,a())})},u=d=>{n(d,"up")},l=(d,o,m,h)=>{const v=new Map(Object.keys(i.fieldInfo).filter(g=>g.startsWith(e(o,m))).map(g=>[g,i.getFieldMeta(g)]));n(d,m<h?"up":"down"),Object.keys(i.fieldInfo).filter(g=>g.startsWith(e(o,h))).forEach(g=>{const M=g.replace(e(o,h),e(o,m)),p=v.get(M);p&&i.setFieldMeta(g,p)})},f=(d,o,m,h)=>{d.forEach(v=>{if(!v.toString().startsWith(e(o,m)))return;const g=v.toString().replace(e(o,m),e(o,h)),[M,p]=[i.getFieldMeta(v),i.getFieldMeta(g)];M&&i.setFieldMeta(g,M),p&&i.setFieldMeta(v,p)})};return{handleArrayFieldMetaShift:r}}class Ht extends Vt{constructor(){super({pluginId:"form-devtools",reconnectEveryMs:1e3})}}const w=new Ht;function ot(i){return{values:i.values??{},errorMap:i.errorMap??{},fieldMetaBase:i.fieldMetaBase??{},isSubmitted:i.isSubmitted??!1,isSubmitting:i.isSubmitting??!1,isValidating:i.isValidating??!1,submissionAttempts:i.submissionAttempts??0,isSubmitSuccessful:i.isSubmitSuccessful??!1,validationMetaMap:i.validationMetaMap??{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0,onDynamic:void 0}}}class jt{constructor(r){this.options={},this.fieldInfo={},this.prevTransformArray=[],this.mount=()=>{const t=this.fieldMetaDerived.mount(),s=this.store.mount(),n=()=>{t(),s(),w.emit("form-unmounted",{id:this._formId})};this.options.listeners?.onMount?.({formApi:this});const{onMount:a}=this.options.validators||{};return w.emit("form-api",{id:this._formId,state:this.store.state,options:this.options}),a&&this.validateSync("mount"),n},this.update=t=>{if(!t)return;const s=this.options;this.options=t;const n=!!t.transform?.deps?.some((u,l)=>u!==this.prevTransformArray[l]),a=t.defaultValues&&!C(t.defaultValues,s.defaultValues)&&!this.state.isTouched,c=!C(t.defaultState,s.defaultState)&&!this.state.isTouched;!a&&!c&&!n||(A(()=>{this.baseStore.setState(()=>ot(Object.assign({},this.state,c?t.defaultState:{},a?{values:t.defaultValues}:{},n?{_force_re_eval:!this.state._force_re_eval}:{})))}),w.emit("form-api",{id:this._formId,state:this.store.state,options:this.options}))},this.reset=(t,s)=>{const{fieldMeta:n}=this.state,a=this.resetFieldMeta(n);t&&!s?.keepDefaultValues&&(this.options={...this.options,defaultValues:t}),this.baseStore.setState(()=>ot({...this.options.defaultState,values:t??this.options.defaultValues??this.options.defaultState?.values,fieldMetaBase:a}))},this.validateAllFields=async t=>{const s=[];return A(()=>{Object.values(this.fieldInfo).forEach(a=>{if(!a.instance)return;const c=a.instance;s.push(Promise.resolve().then(()=>c.validate(t,{skipFormValidation:!0}))),a.instance.state.meta.isTouched||a.instance.setMeta(u=>({...u,isTouched:!0}))})}),(await Promise.all(s)).flat()},this.validateArrayFieldsStartingFrom=async(t,s,n)=>{const a=this.getFieldValue(t),c=Array.isArray(a)?Math.max(a.length-1,0):null,u=[`${t}[${s}]`];for(let o=s+1;o<=(c??0);o++)u.push(`${t}[${o}]`);const l=Object.keys(this.fieldInfo).filter(o=>u.some(m=>o.startsWith(m))),f=[];return A(()=>{l.forEach(o=>{f.push(Promise.resolve().then(()=>this.validateField(o,n)))})}),(await Promise.all(f)).flat()},this.validateField=(t,s)=>{const n=this.fieldInfo[t]?.instance;return n?(n.state.meta.isTouched||n.setMeta(a=>({...a,isTouched:!0})),n.validate(s)):[]},this.validateSync=t=>{const s=ut(t,{...this.options,form:this,validationLogic:this.options.validationLogic||P});let n=!1;const a={};return A(()=>{for(const l of s){if(!l.validate)continue;const f=this.runValidator({validate:l.validate,value:{value:this.state.values,formApi:this,validationSource:"form"},type:"validate"}),{formError:d,fieldErrors:o}=Q(f),m=x(l.cause);for(const h of Object.keys(this.state.fieldMeta)){if(this.baseStore.state.fieldMetaBase[h]===void 0)continue;const v=this.getFieldMeta(h);if(!v)continue;const{errorMap:g,errorSourceMap:M}=v,p=o?.[h],{newErrorValue:b,newSource:V}=vt({newFormValidatorError:p,isPreviousErrorFromFormValidator:M?.[m]==="form",previousErrorValue:g?.[m]});V==="form"&&(a[h]={...a[h],[m]:p}),g?.[m]!==b&&this.setFieldMeta(h,S=>({...S,errorMap:{...S.errorMap,[m]:b},errorSourceMap:{...S.errorSourceMap,[m]:V}}))}this.state.errorMap?.[m]!==d&&this.baseStore.setState(h=>({...h,errorMap:{...h.errorMap,[m]:d}})),(d||o)&&(n=!0)}const c=x("submit");this.state.errorMap?.[c]&&t!=="submit"&&!n&&this.baseStore.setState(l=>({...l,errorMap:{...l.errorMap,[c]:void 0}}));const u=x("server");this.state.errorMap?.[u]&&t!=="server"&&!n&&this.baseStore.setState(l=>({...l,errorMap:{...l.errorMap,[u]:void 0}}))}),{hasErrored:n,fieldsErrorMap:a}},this.validateAsync=async t=>{const s=ct(t,{...this.options,form:this,validationLogic:this.options.validationLogic||P});this.state.isFormValidating||this.baseStore.setState(l=>({...l,isFormValidating:!0}));const n=[];let a;for(const l of s){if(!l.validate)continue;const f=x(l.cause);this.state.validationMetaMap[f]?.lastAbortController.abort();const o=new AbortController;this.state.validationMetaMap[f]={lastAbortController:o},n.push(new Promise(async m=>{let h;try{h=await new Promise((p,b)=>{setTimeout(async()=>{if(o.signal.aborted)return p(void 0);try{p(await this.runValidator({validate:l.validate,value:{value:this.state.values,formApi:this,validationSource:"form",signal:o.signal},type:"validateAsync"}))}catch(V){b(V)}},l.debounceMs)})}catch(p){h=p}const{formError:v,fieldErrors:g}=Q(h);g&&(a=a?{...a,...g}:g);const M=x(l.cause);for(const p of Object.keys(this.state.fieldMeta)){if(this.baseStore.state.fieldMetaBase[p]===void 0)continue;const b=this.getFieldMeta(p);if(!b)continue;const{errorMap:V,errorSourceMap:S}=b,T=a?.[p],{newErrorValue:I,newSource:E}=vt({newFormValidatorError:T,isPreviousErrorFromFormValidator:S?.[M]==="form",previousErrorValue:V?.[M]});V?.[M]!==I&&this.setFieldMeta(p,D=>({...D,errorMap:{...D.errorMap,[M]:I},errorSourceMap:{...D.errorSourceMap,[M]:E}}))}this.baseStore.setState(p=>({...p,errorMap:{...p.errorMap,[M]:v}})),m(a?{fieldErrors:a,errorMapKey:M}:void 0)}))}let c=[];const u={};if(n.length){c=await Promise.all(n);for(const l of c)if(l?.fieldErrors){const{errorMapKey:f}=l;for(const[d,o]of Object.entries(l.fieldErrors)){const h={...u[d]||{},[f]:o};u[d]=h}}}return this.baseStore.setState(l=>({...l,isFormValidating:!1})),u},this.validate=t=>{const{hasErrored:s,fieldsErrorMap:n}=this.validateSync(t);return s&&!this.options.asyncAlways?n:this.validateAsync(t)},this.getFieldValue=t=>W(this.state.values,t),this.getFieldMeta=t=>this.state.fieldMeta[t],this.getFieldInfo=t=>this.fieldInfo[t]||={instance:null,validationMetaMap:{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0,onDynamic:void 0}},this.setFieldMeta=(t,s)=>{this.baseStore.setState(n=>({...n,fieldMetaBase:{...n.fieldMetaBase,[t]:it(s,n.fieldMetaBase[t])}}))},this.resetFieldMeta=t=>Object.keys(t).reduce((s,n)=>{const a=n;return s[a]=et,s},{}),this.setFieldValue=(t,s,n)=>{const a=n?.dontUpdateMeta??!1,c=n?.dontRunListeners??!1,u=n?.dontValidate??!1;A(()=>{a||this.setFieldMeta(t,l=>({...l,isTouched:!0,isDirty:!0,errorMap:{...l?.errorMap,onMount:void 0}})),this.baseStore.setState(l=>({...l,values:z(l.values,t,s)}))}),c||this.getFieldInfo(t).instance?.triggerOnChangeListener(),u||this.validateField(t,"change")},this.deleteField=t=>{const n=[...Object.keys(this.fieldInfo).filter(a=>{const c=t.toString();return a!==c&&a.startsWith(c)}),t];this.baseStore.setState(a=>{const c={...a};return n.forEach(u=>{c.values=Rt(c.values,u),delete this.fieldInfo[u],delete c.fieldMetaBase[u]}),c})},this.pushFieldValue=(t,s,n)=>{this.setFieldValue(t,a=>[...Array.isArray(a)?a:[],s],n)},this.insertFieldValue=async(t,s,n,a)=>{this.setFieldValue(t,u=>[...u.slice(0,s),n,...u.slice(s)],F(a,{dontValidate:!0}));const c=a?.dontValidate??!1;c||await this.validateField(t,"change"),H(this).handleArrayFieldMetaShift(t,s,"insert"),c||await this.validateArrayFieldsStartingFrom(t,s,"change")},this.replaceFieldValue=async(t,s,n,a)=>{this.setFieldValue(t,u=>u.map((l,f)=>f===s?n:l),F(a,{dontValidate:!0})),(a?.dontValidate??!1)||(await this.validateField(t,"change"),await this.validateArrayFieldsStartingFrom(t,s,"change"))},this.removeFieldValue=async(t,s,n)=>{const a=this.getFieldValue(t),c=Array.isArray(a)?Math.max(a.length-1,0):null;if(this.setFieldValue(t,l=>l.filter((f,d)=>d!==s),F(n,{dontValidate:!0})),H(this).handleArrayFieldMetaShift(t,s,"remove"),c!==null){const l=`${t}[${c}]`;this.deleteField(l)}(n?.dontValidate??!1)||(await this.validateField(t,"change"),await this.validateArrayFieldsStartingFrom(t,s,"change"))},this.swapFieldValues=(t,s,n,a)=>{this.setFieldValue(t,u=>{const l=u[s],f=u[n];return z(z(u,`${s}`,f),`${n}`,l)},F(a,{dontValidate:!0})),H(this).handleArrayFieldMetaShift(t,s,"swap",n),(a?.dontValidate??!1)||(this.validateField(t,"change"),this.validateField(`${t}[${s}]`,"change"),this.validateField(`${t}[${n}]`,"change"))},this.moveFieldValues=(t,s,n,a)=>{this.setFieldValue(t,u=>{const l=[...u];return l.splice(n,0,l.splice(s,1)[0]),l},F(a,{dontValidate:!0})),H(this).handleArrayFieldMetaShift(t,s,"move",n),(a?.dontValidate??!1)||(this.validateField(t,"change"),this.validateField(`${t}[${s}]`,"change"),this.validateField(`${t}[${n}]`,"change"))},this.clearFieldValues=(t,s)=>{const n=this.getFieldValue(t),a=Array.isArray(n)?Math.max(n.length-1,0):null;if(this.setFieldValue(t,[],F(s,{dontValidate:!0})),a!==null)for(let u=0;u<=a;u++){const l=`${t}[${u}]`;this.deleteField(l)}(s?.dontValidate??!1)||this.validateField(t,"change")},this.resetField=t=>{this.baseStore.setState(s=>({...s,fieldMetaBase:{...s.fieldMetaBase,[t]:et},values:this.options.defaultValues?z(s.values,t,W(this.options.defaultValues,t)):s.values}))},this.getAllErrors=()=>({form:{errors:this.state.errors,errorMap:this.state.errorMap},fields:Object.entries(this.state.fieldMeta).reduce((t,[s,n])=>(Object.keys(n).length&&n.errors.length&&(t[s]={errors:n.errors,errorMap:n.errorMap}),t),{})}),this.parseValuesWithSchema=t=>B.validate({value:this.state.values,validationSource:"form"},t),this.parseValuesWithSchemaAsync=t=>B.validateAsync({value:this.state.values,validationSource:"form"},t),this.timeoutIds={validations:{},listeners:{},formListeners:{}},this._formId=r?.formId??Gt(),this._devtoolsSubmissionOverride=!1,this.baseStore=new tt(ot({...r?.defaultState,values:r?.defaultValues??r?.defaultState?.values})),this.fieldMetaDerived=new L({deps:[this.baseStore],fn:({prevDepVals:t,currDepVals:s,prevVal:n})=>{const a=n,c=t?.[0],u=s[0];let l=0;const f={};for(const d of Object.keys(u.fieldMetaBase)){const o=u.fieldMetaBase[d],m=c?.fieldMetaBase[d],h=a?.[d],v=W(u.values,d);let g=h?.errors;if(!m||o.errorMap!==m.errorMap){g=Object.values(o.errorMap??{}).filter(S=>S!==void 0);const V=this.getFieldInfo(d)?.instance;V&&!V.options.disableErrorFlat&&(g=g?.flat(1))}const M=!zt(g??[]),p=!o.isDirty,b=C(v,W(this.options.defaultValues,d))||C(v,this.getFieldInfo(d)?.instance?.options.defaultValue);if(h&&h.isPristine===p&&h.isValid===M&&h.isDefaultValue===b&&h.errors===g&&o===m){f[d]=h,l++;continue}f[d]={...o,errors:g,isPristine:p,isValid:M,isDefaultValue:b}}return Object.keys(u.fieldMetaBase).length&&a&&l===Object.keys(u.fieldMetaBase).length?a:f}}),this.store=new L({deps:[this.baseStore,this.fieldMetaDerived],fn:({prevDepVals:t,currDepVals:s,prevVal:n})=>{const a=n,c=t?.[0],u=s[0],l=s[1],f=Object.values(l).filter(Boolean),d=f.some(y=>y.isValidating),o=f.every(y=>y.isValid),m=f.some(y=>y.isTouched),h=f.some(y=>y.isBlurred),v=f.every(y=>y.isDefaultValue),g=m&&u.errorMap?.onMount,M=f.some(y=>y.isDirty),p=!M,b=!!(u.errorMap?.onMount||f.some(y=>y?.errorMap?.onMount)),V=!!d;let S=a?.errors??[];(!c||u.errorMap!==c.errorMap)&&(S=Object.values(u.errorMap).reduce((y,_)=>_===void 0?y:_&&dt(_)?(y.push(_.form),y):(y.push(_),y),[]));const T=S.length===0,I=o&&T,E=this.options.canSubmitWhenInvalid??!1,D=u.submissionAttempts===0&&!m&&!b||!V&&!u.isSubmitting&&I||E;let O=u.errorMap;if(g&&(S=S.filter(y=>y!==u.errorMap.onMount),O=Object.assign(O,{onMount:void 0})),a&&c&&a.errorMap===O&&a.fieldMeta===this.fieldMetaDerived.state&&a.errors===S&&a.isFieldsValidating===d&&a.isFieldsValid===o&&a.isFormValid===T&&a.isValid===I&&a.canSubmit===D&&a.isTouched===m&&a.isBlurred===h&&a.isPristine===p&&a.isDefaultValue===v&&a.isDirty===M&&C(c,u))return a;let rt={...u,errorMap:O,fieldMeta:this.fieldMetaDerived.state,errors:S,isFieldsValidating:d,isFieldsValid:o,isFormValid:T,isValid:I,canSubmit:D,isTouched:m,isBlurred:h,isPristine:p,isDefaultValue:v,isDirty:M};const nt=this.options.transform?.deps??[];if(nt.length!==this.prevTransformArray.length||nt.some((y,_)=>y!==this.prevTransformArray[_])){const y=Object.assign({},this,{state:rt});this.options.transform?.fn(y),rt=y.state,this.prevTransformArray=nt}return rt}}),this.handleSubmit=this.handleSubmit.bind(this),this.update(r||{});const e=Bt(t=>w.emit("form-state",{id:this._formId,state:t}),{wait:300});this.store.subscribe(()=>{e(this.store.state)}),w.on("request-form-state",t=>{t.payload.id===this._formId&&w.emit("form-api",{id:this._formId,state:this.store.state,options:this.options})}),w.on("request-form-reset",t=>{t.payload.id===this._formId&&this.reset()}),w.on("request-form-force-submit",t=>{t.payload.id===this._formId&&(this._devtoolsSubmissionOverride=!0,this.handleSubmit(),this._devtoolsSubmissionOverride=!1)})}get state(){return this.store.state}get formId(){return this._formId}runValidator(r){return Et(r.validate)?B[r.type](r.value,r.validate):r.validate(r.value)}async handleSubmit(r){this.baseStore.setState(s=>({...s,isSubmitted:!1,submissionAttempts:s.submissionAttempts+1,isSubmitSuccessful:!1})),A(()=>{Object.values(this.fieldInfo).forEach(s=>{s.instance&&(s.instance.state.meta.isTouched||s.instance.setMeta(n=>({...n,isTouched:!0})))})});const e=r??this.options.onSubmitMeta;if(!this.state.canSubmit&&!this._devtoolsSubmissionOverride){this.options.onSubmitInvalid?.({value:this.state.values,formApi:this,meta:e});return}this.baseStore.setState(s=>({...s,isSubmitting:!0}));const t=()=>{this.baseStore.setState(s=>({...s,isSubmitting:!1}))};if(await this.validateAllFields("submit"),!this.state.isFieldsValid){t(),this.options.onSubmitInvalid?.({value:this.state.values,formApi:this,meta:e}),w.emit("form-submission",{id:this._formId,submissionAttempt:this.state.submissionAttempts,successful:!1,stage:"validateAllFields",errors:Object.values(this.state.fieldMeta).map(s=>s.errors).flat()});return}if(await this.validate("submit"),!this.state.isValid){t(),this.options.onSubmitInvalid?.({value:this.state.values,formApi:this,meta:e}),w.emit("form-submission",{id:this._formId,submissionAttempt:this.state.submissionAttempts,successful:!1,stage:"validate",errors:this.state.errors});return}A(()=>{Object.values(this.fieldInfo).forEach(s=>{s.instance?.options.listeners?.onSubmit?.({value:s.instance.state.value,fieldApi:s.instance})})}),this.options.listeners?.onSubmit?.({formApi:this,meta:e});try{await this.options.onSubmit?.({value:this.state.values,formApi:this,meta:e}),A(()=>{this.baseStore.setState(s=>({...s,isSubmitted:!0,isSubmitSuccessful:!0})),w.emit("form-submission",{id:this._formId,submissionAttempt:this.state.submissionAttempts,successful:!0}),t()})}catch(s){throw this.baseStore.setState(n=>({...n,isSubmitSuccessful:!1})),w.emit("form-submission",{id:this._formId,submissionAttempt:this.state.submissionAttempts,successful:!1,stage:"inflight",onError:s}),t(),s}}setErrorMap(r){A(()=>{Object.entries(r).forEach(([e,t])=>{const s=e;if(dt(t)){const{formError:n,fieldErrors:a}=Q(t);for(const c of Object.keys(this.fieldInfo))this.getFieldMeta(c)&&this.setFieldMeta(c,l=>({...l,errorMap:{...l.errorMap,[s]:a?.[c]},errorSourceMap:{...l.errorSourceMap,[s]:"form"}}));this.baseStore.setState(c=>({...c,errorMap:{...c.errorMap,[s]:n}}))}else this.baseStore.setState(n=>({...n,errorMap:{...n.errorMap,[s]:t}}))})})}}function Q(i){if(i){if(dt(i)){const r=Q(i.form).formError,e=i.fields;return{formError:r,fieldErrors:e}}return{formError:i}}return{formError:void 0}}function x(i){switch(i){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"dynamic":return"onDynamic";case"change":default:return"onChange"}}class Xt{constructor(r){this.options={},this.mount=()=>{const e=this.store.mount();this.options.defaultValue!==void 0&&this.form.setFieldValue(this.name,this.options.defaultValue,{dontUpdateMeta:!0});const t=this.getInfo();t.instance=this,this.update(this.options);const{onMount:s}=this.options.validators||{};if(s){const n=this.runValidator({validate:s,value:{value:this.state.value,fieldApi:this,validationSource:"field"},type:"validate"});n&&this.setMeta(a=>({...a,errorMap:{...a?.errorMap,onMount:n},errorSourceMap:{...a?.errorSourceMap,onMount:"field"}}))}return this.options.listeners?.onMount?.({value:this.state.value,fieldApi:this}),e},this.update=e=>{this.options=e;const t=this.name!==e.name;if(this.name=e.name,this.state.value===void 0){const s=W(e.form.options.defaultValues,e.name),n=e.defaultValue??s;t?this.setValue(a=>a||n,{dontUpdateMeta:!0}):n!==void 0&&this.setValue(n,{dontUpdateMeta:!0})}this.form.getFieldMeta(this.name)===void 0&&this.setMeta(this.state.meta)},this.getValue=()=>this.form.getFieldValue(this.name),this.setValue=(e,t)=>{this.form.setFieldValue(this.name,e,F(t,{dontRunListeners:!0,dontValidate:!0})),t?.dontRunListeners||this.triggerOnChangeListener(),t?.dontValidate||this.validate("change")},this.getMeta=()=>this.store.state.meta,this.setMeta=e=>this.form.setFieldMeta(this.name,e),this.getInfo=()=>this.form.getFieldInfo(this.name),this.pushValue=(e,t)=>{this.form.pushFieldValue(this.name,e,F(t,{dontRunListeners:!0})),t?.dontRunListeners||this.triggerOnChangeListener()},this.insertValue=(e,t,s)=>{this.form.insertFieldValue(this.name,e,t,F(s,{dontRunListeners:!0})),s?.dontRunListeners||this.triggerOnChangeListener()},this.replaceValue=(e,t,s)=>{this.form.replaceFieldValue(this.name,e,t,F(s,{dontRunListeners:!0})),s?.dontRunListeners||this.triggerOnChangeListener()},this.removeValue=(e,t)=>{this.form.removeFieldValue(this.name,e,F(t,{dontRunListeners:!0})),t?.dontRunListeners||this.triggerOnChangeListener()},this.swapValues=(e,t,s)=>{this.form.swapFieldValues(this.name,e,t,F(s,{dontRunListeners:!0})),s?.dontRunListeners||this.triggerOnChangeListener()},this.moveValue=(e,t,s)=>{this.form.moveFieldValues(this.name,e,t,F(s,{dontRunListeners:!0})),s?.dontRunListeners||this.triggerOnChangeListener()},this.clearValues=e=>{this.form.clearFieldValues(this.name,F(e,{dontRunListeners:!0})),e?.dontRunListeners||this.triggerOnChangeListener()},this.getLinkedFields=e=>{const t=Object.values(this.form.fieldInfo),s=[];for(const n of t){if(!n.instance)continue;const{onChangeListenTo:a,onBlurListenTo:c}=n.instance.options.validators||{};e==="change"&&a?.includes(this.name)&&s.push(n.instance),e==="blur"&&c?.includes(this.name)&&s.push(n.instance)}return s},this.validateSync=(e,t)=>{const s=ut(e,{...this.options,form:this.form,validationLogic:this.form.options.validationLogic||P}),a=this.getLinkedFields(e).reduce((l,f)=>{const d=ut(e,{...f.options,form:f.form,validationLogic:f.form.options.validationLogic||P});return d.forEach(o=>{o.field=f}),l.concat(d)},[]);let c=!1;A(()=>{const l=(f,d)=>{const o=j(d.cause),m=d.validate?Mt(f.runValidator({validate:d.validate,value:{value:f.store.state.value,validationSource:"field",fieldApi:f},type:"validate"})):void 0,h=t[o],{newErrorValue:v,newSource:g}=gt({formLevelError:h,fieldLevelError:m});f.state.meta.errorMap?.[o]!==v&&f.setMeta(M=>({...M,errorMap:{...M.errorMap,[o]:v},errorSourceMap:{...M.errorSourceMap,[o]:g}})),v&&(c=!0)};for(const f of s)l(this,f);for(const f of a)f.validate&&l(f.field,f)});const u=j("submit");return this.state.meta.errorMap?.[u]&&e!=="submit"&&!c&&this.setMeta(l=>({...l,errorMap:{...l.errorMap,[u]:void 0},errorSourceMap:{...l.errorSourceMap,[u]:void 0}})),{hasErrored:c}},this.validateAsync=async(e,t)=>{const s=ct(e,{...this.options,form:this.form,validationLogic:this.form.options.validationLogic||P}),n=await t,a=this.getLinkedFields(e),c=a.reduce((o,m)=>{const h=ct(e,{...m.options,form:m.form,validationLogic:m.form.options.validationLogic||P});return h.forEach(v=>{v.field=m}),o.concat(h)},[]);this.state.meta.isValidating||this.setMeta(o=>({...o,isValidating:!0}));for(const o of a)o.setMeta(m=>({...m,isValidating:!0}));const u=[],l=[],f=(o,m,h)=>{const v=j(m.cause);o.getInfo().validationMetaMap[v]?.lastAbortController.abort();const M=new AbortController;this.getInfo().validationMetaMap[v]={lastAbortController:M},h.push(new Promise(async p=>{let b;try{b=await new Promise((E,D)=>{this.timeoutIds.validations[m.cause]&&clearTimeout(this.timeoutIds.validations[m.cause]),this.timeoutIds.validations[m.cause]=setTimeout(async()=>{if(M.signal.aborted)return E(void 0);try{E(await this.runValidator({validate:m.validate,value:{value:o.store.state.value,fieldApi:o,signal:M.signal,validationSource:"field"},type:"validateAsync"}))}catch(O){D(O)}},m.debounceMs)})}catch(E){b=E}if(M.signal.aborted)return p(void 0);const V=Mt(b),S=n[this.name]?.[v],{newErrorValue:T,newSource:I}=gt({formLevelError:S,fieldLevelError:V});o.setMeta(E=>({...E,errorMap:{...E?.errorMap,[v]:T},errorSourceMap:{...E.errorSourceMap,[v]:I}})),p(T)}))};for(const o of s)o.validate&&f(this,o,u);for(const o of c)o.validate&&f(o.field,o,l);let d=[];(u.length||l.length)&&(d=await Promise.all(u),await Promise.all(l)),this.setMeta(o=>({...o,isValidating:!1}));for(const o of a)o.setMeta(m=>({...m,isValidating:!1}));return d.filter(Boolean)},this.validate=(e,t)=>{if(!this.state.meta.isTouched)return[];const{fieldsErrorMap:s}=t?.skipFormValidation?{fieldsErrorMap:{}}:this.form.validateSync(e),{hasErrored:n}=this.validateSync(e,s[this.name]??{});if(n&&!this.options.asyncAlways)return this.getInfo().validationMetaMap[j(e)]?.lastAbortController.abort(),this.state.meta.errors;const a=t?.skipFormValidation?Promise.resolve({}):this.form.validateAsync(e);return this.validateAsync(e,a)},this.handleChange=e=>{this.setValue(e)},this.handleBlur=()=>{this.state.meta.isTouched||this.setMeta(t=>({...t,isTouched:!0})),this.state.meta.isBlurred||this.setMeta(t=>({...t,isBlurred:!0})),this.validate("blur"),this.triggerOnBlurListener()},this.parseValueWithSchema=e=>B.validate({value:this.state.value,validationSource:"field"},e),this.parseValueWithSchemaAsync=e=>B.validateAsync({value:this.state.value,validationSource:"field"},e),this.form=r.form,this.name=r.name,this.timeoutIds={validations:{},listeners:{},formListeners:{}},this.store=new L({deps:[this.form.store],fn:()=>{const e=this.form.getFieldValue(this.name),t=this.form.getFieldMeta(this.name)??{...et,...r.defaultMeta};return{value:e,meta:t}}}),this.options=r}get state(){return this.store.state}runValidator(r){return Et(r.validate)?B[r.type](r.value,r.validate):r.validate(r.value)}setErrorMap(r){this.setMeta(e=>({...e,errorMap:{...e.errorMap,...r}}))}triggerOnBlurListener(){const r=this.form.options.listeners?.onBlurDebounceMs;r&&r>0?(this.timeoutIds.formListeners.blur&&clearTimeout(this.timeoutIds.formListeners.blur),this.timeoutIds.formListeners.blur=setTimeout(()=>{this.form.options.listeners?.onBlur?.({formApi:this.form,fieldApi:this})},r)):this.form.options.listeners?.onBlur?.({formApi:this.form,fieldApi:this});const e=this.options.listeners?.onBlurDebounceMs;e&&e>0?(this.timeoutIds.listeners.blur&&clearTimeout(this.timeoutIds.listeners.blur),this.timeoutIds.listeners.blur=setTimeout(()=>{this.options.listeners?.onBlur?.({value:this.state.value,fieldApi:this})},e)):this.options.listeners?.onBlur?.({value:this.state.value,fieldApi:this})}triggerOnChangeListener(){const r=this.form.options.listeners?.onChangeDebounceMs;r&&r>0?(this.timeoutIds.formListeners.change&&clearTimeout(this.timeoutIds.formListeners.change),this.timeoutIds.formListeners.change=setTimeout(()=>{this.form.options.listeners?.onChange?.({formApi:this.form,fieldApi:this})},r)):this.form.options.listeners?.onChange?.({formApi:this.form,fieldApi:this});const e=this.options.listeners?.onChangeDebounceMs;e&&e>0?(this.timeoutIds.listeners.change&&clearTimeout(this.timeoutIds.listeners.change),this.timeoutIds.listeners.change=setTimeout(()=>{this.options.listeners?.onChange?.({value:this.state.value,fieldApi:this})},e)):this.options.listeners?.onChange?.({value:this.state.value,fieldApi:this})}}function Mt(i){if(i)return i}function j(i){switch(i){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"dynamic":return"onDynamic";case"change":default:return"onChange"}}function wt(i,r=e=>e){return Lt.useSyncExternalStoreWithSelector(i.subscribe,()=>i.state,()=>i.state,r,Jt)}function Jt(i,r){if(Object.is(i,r))return!0;if(typeof i!="object"||i===null||typeof r!="object"||r===null)return!1;if(i instanceof Map&&r instanceof Map){if(i.size!==r.size)return!1;for(const[t,s]of i)if(!r.has(t)||!Object.is(s,r.get(t)))return!1;return!0}if(i instanceof Set&&r instanceof Set){if(i.size!==r.size)return!1;for(const t of i)if(!r.has(t))return!1;return!0}if(i instanceof Date&&r instanceof Date)return i.getTime()===r.getTime();const e=yt(i);if(e.length!==yt(r).length)return!1;for(let t=0;t<e.length;t++)if(!Object.prototype.hasOwnProperty.call(r,e[t])||!Object.is(i[e[t]],r[e[t]]))return!1;return!0}function yt(i){return Object.keys(i).concat(Object.getOwnPropertySymbols(i))}const st=typeof window<"u"?R.useLayoutEffect:R.useEffect;function Qt(i){const[r]=R.useState(()=>{const t=new Xt({...i,form:i.form,name:i.name});return t.Field=At,t});return st(r.mount,[r]),st(()=>{r.update(i)}),wt(r.store,i.mode==="array"?e=>[e.meta,Object.keys(e.value??[]).length]:void 0),r}const At=(({children:i,...r})=>{const e=Qt(r),t=R.useMemo(()=>it(i,e),[i,e,e.state.value,e.state.meta]);return Y.jsx(Y.Fragment,{children:t})});function Yt({form:i,selector:r,children:e}){const t=wt(i.store,r);return it(e,t)}function ee(i){const r=R.useId(),[e]=R.useState(()=>{const t=new jt({...i,formId:r}),s=t;return s.Field=function(a){return Y.jsx(At,{...a,form:t})},s.Subscribe=function(a){return Y.jsx(Yt,{form:t,selector:a.selector,children:a.children})},s});return st(e.mount,[]),st(()=>{e.update(i)}),e}export{ee as u};
